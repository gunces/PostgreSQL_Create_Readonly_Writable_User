-- Kullanıcının dbreader'den inherit olmasını sağlar. 
-- dtdba.dbf_make_readonly() 

CREATE OR REPLACE FUNCTION dtdba.dbf_make_readonly(f_username text)
    RETURNS void
    LANGUAGE 'plpgsql'

    COST 100
    VOLATILE 
AS $BODY$
DECLARE
schemanames TEXT;
ifexistsdbreader INT;
usr_password TEXT;
cur_database TEXT;
BEGIN
	IF NOT EXISTS(SELECT rolname FROM pg_catalog.pg_roles WHERE rolname='dbreader') THEN 
		RAISE EXCEPTION 'First create dbreader role than execute dtdba.dbf_make_readonly(text) function';
	END IF;

	EXECUTE 'ALTER USER "'|| f_username || '" INHERIT';
	RAISE NOTICE 'ALTER USER "%" INHERIT', f_username;
	EXECUTE 'GRANT dbreader TO "'|| f_username || '"';
	RAISE NOTICE 'GRANT dbreader TO "%"', f_username;

END;
$BODY$;


-- SELECT dtdba.dbf_make_readonly('XX'); 